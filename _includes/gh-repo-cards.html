<!-- _includes/gh-repo-cards.html -->
<div id="gh-repos" class="gh-repos"
     data-username="{{ include.username | default: site.github.owner_name | default: 'gerardorglz' }}"
     data-count="{{ include.count | default: 8 }}">
</div>

<style>
.gh-repos .gh-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-top:12px}
.gh-repos .gh-card{background:var(--mm-card-bg,#fff);border:1px solid #eaecef;border-radius:12px;padding:16px;transition:transform .15s ease, box-shadow .15s ease}
.gh-repos .gh-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.06)}
.gh-repos .gh-title{font-weight:600;margin:0 0 6px;display:flex;align-items:center;gap:8px;font-size:1.02rem}
.gh-repos .gh-title a{text-decoration:none}
.gh-repos .gh-desc{color:#444;margin:0 0 10px;min-height:3.2em}
.gh-repos .gh-meta{display:flex;gap:12px;align-items:center;font-size:.9rem;color:#57606a}
.gh-repos .gh-lang{display:flex;align-items:center;gap:6px}
.gh-repos .gh-lang-dot{width:10px;height:10px;border-radius:50%}
@media (prefers-color-scheme: dark){
  .gh-repos .gh-card{background:#0d1117;border-color:#30363d}
  .gh-repos .gh-desc,.gh-repos .gh-meta{color:#c9d1d9}
}
</style>

<script>
(async () => {
  const wrap = document.getElementById('gh-repos');
  const username = (wrap?.dataset.username || 'gerardorglz').trim();
  const max = parseInt(wrap?.dataset.count || '8', 10);
  const url = `https://api.github.com/users/${username}/repos?per_page=100&sort=updated`;
  try {
    const res = await fetch(url, {
      headers: {
        'Accept': 'application/vnd.github+json',
        'X-GitHub-Api-Version': '2022-11-28'
      }
    });
    if (!res.ok) throw new Error(String(res.status));
    let repos = await res.json();

    // Oculta forks, el repo del sitio y archivados
    repos = repos.filter(r => !r.fork && !r.archived && r.name !== `${username}.github.io`);

    // Orden: estrellas desc y luego updated_at desc
    repos.sort((a,b) =>
      (b.stargazers_count - a.stargazers_count) ||
      (new Date(b.updated_at) - new Date(a.updated_at))
    );

    const finalList = repos.slice(0, max);
    const colors = {'Python':'#3572A5','Jupyter Notebook':'#DA5B0B','JavaScript':'#f1e05a',
      'TypeScript':'#3178c6','HTML':'#e34c26','CSS':'#563d7c','Ruby':'#701516',
      'Shell':'#89e051','R':'#198CE7','C':'#555','#C++':'#f34b7d','TeX':'#3D6117'};

    const grid = document.createElement('div');
    grid.className = 'gh-grid';

    finalList.forEach(r => {
      const lang = r.language || '—';
      const color = colors[lang] || '#999';
      const desc = (r.description || '').slice(0, 160);

      const card = document.createElement('article');
      card.className = 'gh-card';
      card.innerHTML = `
        <h3 class="gh-title">
          <a href="${r.html_url}" target="_blank" rel="noopener noreferrer">${r.name}</a>
        </h3>
        <p class="gh-desc">${desc}</p>
        <div class="gh-meta">
          <span class="gh-lang"><span class="gh-lang-dot" style="background:${color}"></span>${lang}</span>
          <span title="Stars">★ ${r.stargazers_count}</span>
          <span title="Forks">⑂ ${r.forks_count}</span>
          <span style="margin-left:auto">Updated ${new Date(r.updated_at).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'})}</span>
        </div>`;
      grid.appendChild(card);
    });

    wrap.appendChild(grid);
  } catch (e) {
    wrap.innerHTML = `<p>No pude cargar los repos ahora. Intenta recargar.</p>`;
  }
})();
</script>
