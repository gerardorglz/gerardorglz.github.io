<!-- _includes/gh-repo-cards-manual.html -->
<div id="gh-repos-manual" class="gh-repos-manual"
     data-default-owner="{{ include.username | default: site.github.owner_name | default: 'gerardorglz' }}"
     data-repos="{{ include.repos | escape }}">

  <p>Cargando repositorios…</p>
</div>

<style>
.gh-repos-manual .gh-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-top:12px}
.gh-repos-manual .gh-card{background:var(--mm-card-bg,#fff);border:1px solid #eaecef;border-radius:12px;padding:16px;transition:transform .15s ease, box-shadow .15s ease}
.gh-repos-manual .gh-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,.06)}
.gh-repos-manual .gh-title{font-weight:600;margin:0 0 6px;display:flex;align-items:center;gap:8px;font-size:1.02rem}
.gh-repos-manual .gh-title a{text-decoration:none}
.gh-repos-manual .gh-desc{color:#444;margin:0 0 10px;min-height:3.2em}
.gh-repos-manual .gh-meta{display:flex;gap:12px;align-items:center;font-size:.9rem;color:#57606a;flex-wrap:wrap}
.gh-repos-manual .gh-lang{display:flex;align-items:center;gap:6px}
.gh-repos-manual .gh-lang-dot{width:10px;height:10px;border-radius:50%}
@media (prefers-color-scheme: dark){
  .gh-repos-manual .gh-card{background:#0d1117;border-color:#30363d}
  .gh-repos-manual .gh-desc,.gh-repos-manual .gh-meta{color:#c9d1d9}
}
</style>

<script>
(async () => {
  const wrap = document.getElementById('gh-repos-manual');
  const defaultOwner = (wrap?.dataset.defaultOwner || 'gerardorglz').trim();
  const listRaw = (wrap?.dataset.repos || '').trim();

  // Lista manual: admite "owner/repo" o solo "repo" (usa defaultOwner).
  let items = listRaw.split(',').map(s => s.trim()).filter(Boolean);
  if (items.length === 0) { wrap.innerHTML = '<p>No hay repos configurados.</p>'; return; }

  // Normaliza a {owner,repo} y quita duplicados.
  const norm = (s) => {
    if (s.includes('/')) { const [o,r] = s.split('/'); return {owner:o, repo:r}; }
    return {owner: defaultOwner, repo: s};
  };
  const pairs = Array.from(new Map(items.map(x => {
    const p = norm(x);
    return [`${p.owner}/${p.repo}`.toLowerCase(), p];
  })).values());

  // Mapea colores de lenguaje (fallbacks sencillos)
  const colors = {
    'Python':'#3572A5','Jupyter Notebook':'#DA5B0B','JavaScript':'#f1e05a',
    'TypeScript':'#3178c6','HTML':'#e34c26','CSS':'#563d7c','Ruby':'#701516',
    'Shell':'#89e051','R':'#198CE7','C':'#555','#C++':'#f34b7d','TeX':'#3D6117'
  };

  // Descarga metadatos por repo (manteniendo el orden dado por ti)
  const headers = {
    'Accept':'application/vnd.github+json',
    'X-GitHub-Api-Version':'2022-11-28'
  };
  const fetchOne = async ({owner, repo}) => {
    const url = `https://api.github.com/repos/${owner}/${repo}`;
    const res = await fetch(url, {headers});
    if (!res.ok) return {error: true, owner, repo, status: res.status};
    const r = await res.json();
    return r;
  };

  const results = await Promise.all(pairs.map(fetchOne));

  // Construye el grid
  const grid = document.createElement('div');
  grid.className = 'gh-grid';

  results.forEach(r => {
    if (r.error) {
      const card = document.createElement('article');
      card.className = 'gh-card';
      card.innerHTML = `<h3 class="gh-title">${r.owner}/${r.repo}</h3>
                        <p class="gh-desc">No se pudo cargar (status ${r.status}).</p>`;
      grid.appendChild(card);
      return;
    }
    const lang = r.language || '—';
    const color = colors[lang] || '#999';
    const desc = (r.description || '').slice(0, 200);
    const updated = new Date(r.updated_at).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});

    const card = document.createElement('article');
    card.className = 'gh-card';
    card.innerHTML = `
      <h3 class="gh-title">
        <a href="${r.html_url}" target="_blank" rel="noopener noreferrer">${r.name}</a>
      </h3>
      <p class="gh-desc">${desc}</p>
      <div class="gh-meta">
        <span>by <strong>${r.owner.login}</strong></span>
        <span class="gh-lang"><span class="gh-lang-dot" style="background:${color}"></span>${lang}</span>
        <span title="Stars">★ ${r.stargazers_count}</span>
        <span title="Forks">⑂ ${r.forks_count}</span>
        <span style="margin-left:auto">Updated ${updated}</span>
      </div>
    `;
    grid.appendChild(card);
  });

  wrap.innerHTML = '';
  wrap.appendChild(grid);
})();
</script>
